<Window x:Class="FileEncrypter.HistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="📋 Historial de Encriptación"
        Width="1000" Height="600"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource SurfaceBrush}"
        MinWidth="800" MinHeight="500">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource AccentBrush}" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="📋 Historial de Encriptación" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White"/>
                    <TextBlock x:Name="MachineIdText"
                               Text="ID de Máquina: Loading..."
                               FontSize="12"
                               Foreground="White"
                               Opacity="0.8"
                               Margin="0,4,0,0"/>
                </StackPanel>
                
                <Button Grid.Column="1"
                        Content="🔄 Actualizar"
                        Style="{StaticResource AccentButton}"
                        Background="White"
                        Foreground="{StaticResource AccentBrush}"
                        Click="RefreshButton_Click"/>
            </Grid>
        </Border>

        <!-- Statistics -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="20,20,20,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="📁" FontSize="24" HorizontalAlignment="Center" Foreground="{StaticResource AccentBrush}"/>
                    <TextBlock x:Name="TotalEncryptedText" Text="0" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBlock Text="Archivos Encriptados" FontSize="12" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}" Opacity="0.8"/>
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="🔓" FontSize="24" HorizontalAlignment="Center" Foreground="#FF10B981"/>
                    <TextBlock x:Name="TotalDecryptedText" Text="0" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBlock Text="Archivos Desencriptados" FontSize="12" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}" Opacity="0.8"/>
                </StackPanel>

                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="💾" FontSize="24" HorizontalAlignment="Center" Foreground="#FF8B5CF6"/>
                    <TextBlock x:Name="TotalSizeText" Text="0 MB" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBlock Text="Tamaño Total" FontSize="12" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}" Opacity="0.8"/>
                </StackPanel>

                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="⚡" FontSize="24" HorizontalAlignment="Center" Foreground="#FFFBBF24"/>
                    <TextBlock x:Name="SuccessRateText" Text="0%" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBlock Text="Tasa de Éxito" FontSize="12" HorizontalAlignment="Center" Foreground="{StaticResource OnSurfaceBrush}" Opacity="0.8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- History List -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Margin="20,20,20,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Filter Controls -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="🔍 Buscar:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"
                               Foreground="{StaticResource OnSurfaceBrush}"/>

                    <TextBox Grid.Column="1"
                             x:Name="SearchTextBox"
                             Style="{StaticResource ModernTextBox}"
                             TextChanged="SearchTextBox_TextChanged"
                             Margin="0,0,16,0"/>

                    <ComboBox Grid.Column="2"
                              x:Name="FilterComboBox"
                              Style="{StaticResource ModernComboBox}"
                              SelectionChanged="FilterComboBox_SelectionChanged"
                              Margin="0,0,16,0"
                              MinWidth="150">
                        <ComboBoxItem Content="Todos los archivos" IsSelected="True"/>
                        <ComboBoxItem Content="Solo encriptados"/>
                        <ComboBoxItem Content="Solo desencriptados"/>
                    </ComboBox>

                    <Button Grid.Column="3"
                            Content="🗑️ Limpiar Historial"
                            Style="{StaticResource AccentButton}"
                            Background="#FFEF4444"
                            Click="ClearHistoryButton_Click"/>
                </Grid>

                <!-- History DataGrid -->
                <DataGrid Grid.Row="1"
                          x:Name="HistoryDataGrid"
                          Style="{StaticResource ModernDataGrid}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          GridLinesVisibility="Horizontal"
                          MouseDoubleClick="HistoryDataGrid_MouseDoubleClick">
                    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="📁 Archivo" Binding="{Binding OriginalFileName}" Width="200" MinWidth="150"/>
                        <DataGridTextColumn Header="📅 Fecha Encriptación" Binding="{Binding EncryptionDate, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="150"/>
                        <DataGridTextColumn Header="💾 Tamaño" Binding="{Binding FormattedFileSize}" Width="100"/>
                        <DataGridTextColumn Header="🔒 Estado" Binding="{Binding StatusText}" Width="120"/>
                        <DataGridTextColumn Header="🔓 Fecha Desencriptación" Binding="{Binding DecryptionDate, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="150"/>
                        <DataGridTextColumn Header="📂 Ubicación Original" Binding="{Binding OriginalFilePath}" Width="*" MinWidth="200"/>
                        
                        <DataGridTemplateColumn Header="Acciones" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="📂" 
                                                ToolTip="Abrir ubicación del archivo encriptado"
                                                Style="{StaticResource SmallButton}"
                                                Margin="2"
                                                Click="OpenEncryptedLocation_Click"
                                                Tag="{Binding}"/>
                                        <Button Content="🗑️" 
                                                ToolTip="Eliminar del historial"
                                                Style="{StaticResource SmallButton}"
                                                Margin="2"
                                                Background="#FFEF4444"
                                                Click="DeleteEntry_Click"
                                                Tag="{Binding}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="{x:Type DataGridRow}">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDecrypted}" Value="True">
                                    <Setter Property="Background" Value="#FF064E3B"/>
                                </DataTrigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                    <Setter Property="Opacity" Value="0.1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyStatePanel"
                           Grid.Row="1"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Collapsed">
                    <TextBlock Text="📭" FontSize="48" HorizontalAlignment="Center" Foreground="{StaticResource AccentBrush}" Opacity="0.5"/>
                    <TextBlock Text="No hay archivos en el historial" 
                               FontSize="18" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center" 
                               Foreground="{StaticResource OnSurfaceBrush}"
                               Opacity="0.7"
                               Margin="0,16,0,8"/>
                    <TextBlock Text="Los archivos que encriptes aparecerán aquí" 
                               FontSize="14" 
                               HorizontalAlignment="Center" 
                               Foreground="{StaticResource OnSurfaceBrush}"
                               Opacity="0.5"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Footer -->
        <Border Grid.Row="3" Background="{StaticResource AccentBrush}" Padding="20,12" Margin="0,20,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="💡 Haz doble clic en una entrada para ver más detalles"
                           VerticalAlignment="Center"
                           Foreground="White"
                           Opacity="0.8"/>

                <Button Grid.Column="1"
                        Content="✖️ Cerrar"
                        Style="{StaticResource AccentButton}"
                        Background="White"
                        Foreground="{StaticResource AccentBrush}"
                        Click="CloseButton_Click"/>
            </Grid>
        </Border>
    </Grid>
</Window> 